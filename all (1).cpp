#include <iostream>
#include <string>
using namespace std;

// Функция для нахождения дробной части числа
double fraction(double x) { 
    // Пока число >= 1, уменьшаем его на 1, чтобы оставить только дробную часть
    while (x >= 1) x += -1;
    return x; // возвращаем дробную часть
}

// Функция для перевода целой части числа в другую систему счисления
string int_part(double n, int p) { 
    int x = static_cast<int>(n); // приводим число к целому типу
    if (x == 0) return "0"; // если число 0, возвращаем "0"
    string result = ""; // строка для результата
    string letters[6] = {"A", "B", "C", "D", "E", "F"}; // для цифр выше 9
    
    // Цикл для преобразования числа в систему p
    while (x) {
        // Если остаток больше 9, используем буквы
        if (x % p > 9) {
            for (auto i = 10; i < 16; i++) {
                if (x % p == i) result = letters[i - 10] + result; // добавляем букву в результат
            }
        }
        else {
            result = to_string(x % p) + result; // добавляем цифру
        }
        x /= p; // делим число на основание системы
    }
    return result; // возвращаем строку с числом в новой системе
}

// Функция для перевода дробной части числа в другую систему счисления
string frac_part(double n, int p, int e) { 
    double x = fraction(n); // получаем дробную часть числа
    int cnt = 0; // счетчик для количества итераций
    string result = ""; // строка для результата
    string letters[6] = { "A", "B", "C", "D", "E", "F" }; // буквы для цифр выше 9
    
    // Цикл для преобразования дробной части с точностью e символов
    while (cnt < e) {
        x *= p; // умножаем дробную часть на основание системы
        cnt += 1; // увеличиваем счетчик
        // Если результат >= 10, используем буквы
        if (x >= 10) {
            for (auto i = 10; i < 16; i++) {
                if ((x >= i) && (x < i + 1)) { 
                    result += letters[i - 10]; // добавляем букву
                }
            }
        }
        else { 
            result += to_string(static_cast<int>(x)); // добавляем цифру
        }
        // Если дробная часть равна нулю, прерываем цикл
        if (fraction(x) == 0) break;
        x = fraction(x); // обновляем дробную часть
    }
    return result; // возвращаем строку с дробной частью
}

// Основная функция объединяет целую и дробную части
string changer(double n, int p, int e) {
    if (fraction(n) == 0) 
        return int_part(n, p); // если число целое, возвращаем только целую часть
    else 
        return int_part(n, p) + "." + frac_part(n, p, e); // иначе объединяем целую и дробную части через точку
}

int main() {
    // Константа для максимальной точности дробной части
    const int e = 10; 
    // Массив оснований систем счисления
    int bases[3] = { 2, 8, 16 };
    // Массив чисел для преобразования
    double nums[5] = {164, 255, 712.25, 670.25, 11.89};
    
    // Проход по всем числам и системам
    for (int i = 0; i < size(nums); i++) {
        for (int j = 0; j < size(bases); j++) {
            // Вывод результата преобразования
            cout << nums[i] << " = " << changer(nums[i], bases[j], e) << " (" << bases[j] << ")\n";
        }
    }
}